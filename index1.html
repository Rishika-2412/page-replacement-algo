<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Page Replacement Visualizer</title>
  <style>
    :root{--bg:#f4f7fb;--card:#fff;--accent:#6c5ce7;--muted:#6b7280}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;margin:0;background:linear-gradient(180deg,#f7f9ff 0%,#eef2ff 100%);color:#0f172a}
    .wrap{max-width:1100px;margin:28px auto;padding:20px}
    header{display:flex;align-items:center;gap:16px}
    h1{margin:0;font-size:20px}
    .grid{display:grid;grid-template-columns:320px 1fr;gap:18px;margin-top:18px}
    .card{background:var(--card);border-radius:10px;padding:14px;box-shadow:0 6px 18px rgba(15,23,42,0.06)}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type=text],select,input[type=number]{width:100%;padding:8px;border-radius:6px;border:1px solid #e6eef8;background:#fbfdff}
    button{background:var(--accent);color:white;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}
    .btn-row{display:flex;gap:8px;margin-top:10px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px solid #eef2f7;font-size:13px}
    th{background:#fbfdff;text-align:left}
    .small{font-size:12px;color:var(--muted)}
    .timeline{display:flex;gap:6px;flex-wrap:wrap;margin:12px 0}
    .chip{background:#eef2ff;padding:8px 10px;border-radius:8px;box-shadow:0 2px 6px rgba(16,24,40,0.04)}
    .steps{display:flex;gap:12px;align-items:flex-start}
    .frame-col{min-width:140px}
    .metric-row{display:flex;gap:12px;margin-top:12px}
    .metric{flex:1;padding:12px;border-radius:10px;background:linear-gradient(180deg,#6c5ce7,#5b4ef0);color:white;text-align:center}
    .result-table th, .result-table td{font-size:13px}
    .muted{color:var(--muted)}
    .danger{background:#ffecec;color:#b91c1c}
    .success{background:#effaf2;color:#047857}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 24 24'%3E%3Cpath fill='%236c5ce7' d='M3 13h2v-2H3v2zm4 0h14v-2H7v2zM3 7h18V5H3v2zM3 19h8v-2H3v2z'/%3E%3C/svg%3E" alt="logo"/>
      <div>
        <h1>Page Replacement Visualizer</h1>
        <div class="small">Reference-inspired layout â€” FIFO, LRU, Optimal with step-by-step and summary</div>
      </div>
    </header>

    <div class="grid">
      <aside class="card">
        <label>Reference string (comma or space separated)</label>
        <input id="refs" type="text" value="7 0 1 2 0 3 0 4 2 3 0 3 2"/>

        <label style="margin-top:10px">Frames</label>
        <input id="frames" type="number" min="1" max="10" value="3" />

        <label style="margin-top:10px">Algorithm</label>
        <select id="algo">
          <option>FIFO</option>
          <option selected>LRU</option>
          <option>Optimal</option>
        </select>

        <div class="btn-row">
          <button id="run">Run</button>
          <button id="step">Step</button>
          <button id="animate">Animate</button>
          <button id="reset" style="background:#94a3b8">Reset</button>
        </div>

        <div style="margin-top:12px">
          <div class="small">Speed (s)</div>
          <input id="speed" type="number" step="0.1" min="0.1" max="2" value="0.7" />
        </div>

        <hr style="margin:12px 0;border:none;border-top:1px solid #eef2f7"/>
        <div class="small">Process Table (visual reference only)</div>
        <table style="margin-top:8px">
          <thead><tr><th>Index</th><th>Page</th></tr></thead>
          <tbody id="processTbl"></tbody>
        </table>
      </aside>

      <main>
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div class="small">Timeline</div>
            <div class="small muted" id="status">Ready</div>
          </div>

          <div class="timeline" id="timelineArea"></div>

          <div class="steps" id="stepsArea" style="margin-top:6px"></div>

          <div class="metric-row" id="metrics"></div>
        </div>

        <div style="height:16px"></div>

        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div class="small">Execution Summary</div>
            <div class="small muted">Steps: <span id="totalSteps">0</span></div>
          </div>
          <div id="summaryCards" style="display:flex;gap:12px;margin-top:12px"></div>

          <hr style="margin:12px 0;border:none;border-top:1px solid #eef2f7"/>
          <div class="small">Results table</div>
          <table class="result-table" style="margin-top:8px">
            <thead><tr><th>Step</th><th>Ref</th><th>Frames</th><th>Fault?</th></tr></thead>
            <tbody id="resultsBody"></tbody>
          </table>
        </div>
      </main>
    </div>
  </div>

  <script>
    // Utilities
    const el = id => document.getElementById(id);
    function parseRefs(s){ return s.replace(/,/g,' ').trim().split(/\s+/).filter(Boolean).map(x=>parseInt(x)); }

    function simulateFIFO(refs, framesCount){
      const frames=[]; let fifo=0; const steps=[]; let faults=0;
      refs.forEach(r=>{
        const hit = frames.includes(r);
        if(!hit){
          if(frames.length < framesCount) frames.push(r);
          else { frames[fifo]=r; fifo=(fifo+1)%framesCount; }
          faults++;
        }
        steps.push({frames: [...frames], hit});
      });
      return {steps,faults};
    }

    function simulateLRU(refs, framesCount){
      const frames=[]; const recent=[]; const steps=[]; let faults=0;
      refs.forEach(r=>{
        const hit=frames.includes(r);
        if(hit){ recent.splice(recent.indexOf(r),1); recent.push(r); }
        else{
          if(frames.length < framesCount){ frames.push(r); recent.push(r); }
          else{ const lru = recent.shift(); const idx=frames.indexOf(lru); frames[idx]=r; recent.push(r); }
          faults++;
        }
        steps.push({frames:[...frames], hit});
      });
      return {steps,faults};
    }

    function simulateOptimal(refs, framesCount){
      const frames=[]; const steps=[]; let faults=0;
      for(let i=0;i<refs.length;i++){
        const r=refs[i]; const hit=frames.includes(r);
        if(hit){ steps.push({frames:[...frames], hit}); continue; }
        if(frames.length < framesCount){ frames.push(r); faults++; steps.push({frames:[...frames], hit:false}); continue; }
        let far=-1; let farPage=null;
        frames.forEach(p=>{ const next = refs.indexOf(p,i+1); const dist = next===-1?Infinity:next; if(dist>far){ far=dist; farPage=p; } });
        const idx=frames.indexOf(farPage); frames[idx]=r; faults++; steps.push({frames:[...frames], hit:false});
      }
      return {steps,faults};
    }

    const ALGO = { FIFO:simulateFIFO, LRU:simulateLRU, Optimal:simulateOptimal };

    // UI state
    let state = {refs:[], frames:3, algo:'LRU', steps:[], stepIndex:0, anim:false, speed:0.7};

    function refreshProcessTbl(refs){
      const tbody = el('processTbl'); tbody.innerHTML=''; refs.forEach((r,i)=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${i+1}</td><td>${r}</td>`; tbody.appendChild(tr); });
    }

    function renderTimeline(refs, idx=0){
      const area = el('timelineArea'); area.innerHTML=''; refs.forEach((r,i)=>{ const c=document.createElement('div'); c.className='chip'; c.textContent=r; if(i===idx) c.style.boxShadow='0 6px 20px rgba(108,92,231,0.22)'; area.appendChild(c); });
    }

    function renderSteps(){
      const area = el('stepsArea'); area.innerHTML='';
      const framesCount = state.frames;
      if(state.steps.length===0) return;
      const fs = state.steps[state.stepIndex].frames;
      for(let i=0;i<framesCount;i++){
        const col=document.createElement('div'); col.className='frame-col';
        const title = document.createElement('div'); title.className='small muted'; title.textContent=`Frame ${i+1}`; col.appendChild(title);
        const box=document.createElement('div'); box.style.marginTop='8px'; box.style.padding='10px'; box.style.border='1px solid #eef2f7'; box.style.borderRadius='8px'; box.style.minHeight='36px';
        box.textContent = (fs[i]===undefined?'-':fs[i]); col.appendChild(box);
        area.appendChild(col);
      }
      el('status').textContent = state.steps[state.stepIndex].hit? 'HIT': 'PAGE FAULT';
    }

    function renderResultsTable(){
      const tbody = el('resultsBody'); tbody.innerHTML='';
      state.steps.forEach((s,i)=>{
        const tr=document.createElement('tr');
        const ref = parseRefs(el('refs').value)[i];
        tr.innerHTML = `<td>${i+1}</td><td>${ref}</td><td>${s.frames.map(x=>x===undefined?'-':x).join(' | ')}</td><td>${s.hit? 'No':'Yes'}</td>`;
        tbody.appendChild(tr);
      });
      el('totalSteps').textContent = state.steps.length;
    }

    function computeMetrics(){
      // For page replacement, common metrics are page faults. We'll show faults and fault ratio.
      const faults = state.steps.filter(s=>!s.hit).length;
      const ratio = (faults/state.steps.length*100)||0;
      const metrics = el('metrics'); metrics.innerHTML='';
      const m1 = document.createElement('div'); m1.className='metric'; m1.innerHTML = `<div class="small">Page Faults</div><div style="font-size:20px;margin-top:6px">${faults}</div><div class="small">(${ratio.toFixed(1)}%)</div>`;
      metrics.appendChild(m1);

      const m2 = document.createElement('div'); m2.className='metric'; m2.innerHTML = `<div class="small">Frames</div><div style="font-size:20px;margin-top:6px">${state.frames}</div><div class="small">Algorithm: ${state.algo}</div>`;
      metrics.appendChild(m2);

      const m3 = document.createElement('div'); m3.className='metric'; m3.innerHTML = `<div class="small">References</div><div style="font-size:20px;margin-top:6px">${state.refs.length}</div><div class="small">Steps</div>`;
      metrics.appendChild(m3);
    }

    function renderSummaryCards(){
      const wrap = el('summaryCards'); wrap.innerHTML='';
      const faults = state.steps.filter(s=>!s.hit).length;
      const card=document.createElement('div'); card.className='card'; card.style.flex='1'; card.innerHTML = `<div class="small">Summary</div><div style="margin-top:8px"><strong>Algorithm:</strong> ${state.algo}</div><div style="margin-top:6px"><strong>Frames:</strong> ${state.frames}</div><div style="margin-top:6px"><strong>Page Faults:</strong> ${faults}</div>`;
      wrap.appendChild(card);
    }

    function runSimulation(){
      try{
        state.refs = parseRefs(el('refs').value);
      }catch(e){ alert('Invalid refs'); return; }
      state.frames = parseInt(el('frames').value,10)||3;
      state.algo = el('algo').value;
      refreshProcessTbl(state.refs);
      renderTimeline(state.refs,0);
      const sim = ALGO[state.algo](state.refs,state.frames);
      state.steps = sim.steps; state.stepIndex = 0;
      renderSteps(); renderResultsTable(); computeMetrics(); renderSummaryCards();
    }

    // controls
    el('run').addEventListener('click', ()=>{ runSimulation(); });
    el('step').addEventListener('click', ()=>{ if(state.steps.length===0) runSimulation(); else{ if(state.stepIndex < state.steps.length-1) state.stepIndex++; renderTimeline(state.refs,state.stepIndex); renderSteps(); } renderResultsTable(); });
    el('reset').addEventListener('click', ()=>{ state={refs:[],frames:3,algo:'LRU',steps:[],stepIndex:0,anim:false,speed:0.7}; el('refs').value=''; el('frames').value=3; el('algo').value='LRU'; el('status').textContent='Ready'; el('timelineArea').innerHTML=''; el('stepsArea').innerHTML=''; el('resultsBody').innerHTML=''; el('processTbl').innerHTML=''; el('metrics').innerHTML=''; el('summaryCards').innerHTML=''; el('totalSteps').textContent='0'; });

    let animTimer=null;
    el('animate').addEventListener('click', ()=>{
      if(state.steps.length===0) runSimulation();
      if(state.anim){ state.anim=false; el('animate').textContent='Animate'; clearInterval(animTimer); return; }
      state.anim=true; el('animate').textContent='Stop';
      const speed = parseFloat(el('speed').value)||0.7;
      animTimer = setInterval(()=>{
        if(state.stepIndex < state.steps.length-1){ state.stepIndex++; renderTimeline(state.refs,state.stepIndex); renderSteps(); renderResultsTable(); }
        else { clearInterval(animTimer); state.anim=false; el('animate').textContent='Animate'; }
      }, Math.max(80, speed*1000));
    });

    // initialize sample
    el('refs').value = '7 0 1 2 0 3 0 4 2 3 0 3 2';
    runSimulation();
  </script>
</body>
</html>